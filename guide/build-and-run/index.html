<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Build and Run - FreeTensor</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Build and Run";
        var mkdocs_page_input_path = "guide/build-and-run.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> FreeTensor
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">FreeTensor</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/roastduck/FreeTensor">GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Get Started</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Build and Run</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#build">Build</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#run-a-program-with-freetensor">Run a Program with FreeTensor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#global-configurations">Global Configurations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#run-the-tests">Run the Tests</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#build-this-document">Build this Document</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../first-program/">Your First Program with FreeTenor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../schedules/">Optimize a Program with Schedules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gpu/">Running on a GPU</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ad/">Automatic Differentiation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/">Python API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doxygen/html/">Internal C++ Interface</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/contrib/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/pub/">Publication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/roastduck/FreeTensor/blob/master/LICENSE">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FreeTensor</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>User Guide &raquo;</li><li>Build and Run</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="build-and-run">Build and Run<a class="headerlink" href="#build-and-run" title="Permanent link">&para;</a></h1>
<h2 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">&para;</a></h2>
<ul>
<li>Linux</li>
<li>Python (&gt;= 3.8, for the Python frontend)</li>
<li>GCC (&gt;= 10, to support C++20 and the "unroll" pragma)</li>
<li>CUDA (&gt;= 11.4.1, to support GCC 10, Optional)</li>
<li>MKL (Optional)</li>
<li>PyTorch (Optional, see below)</li>
<li>Java (= 11, Build-time dependency only)</li>
</ul>
<p>Other Python dependencies:</p>
<pre><code class="language-sh">pip3 install --user numpy sourceinspect astor Pygments xgboost
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note on Python version</p>
<p>Because we are analyzing Python AST, which is sensitive to Python version, there may be potential bugs for Python strictly later than 3.8. Please file an issue if something goes wrong</p>
</div>
<div class="admonition note">
<p class="admonition-title">PyTorch support</p>
<p>FreeTensor can optionally link PyTorch to support a copy-free interface between FreeTensor and PyTorch. Please note that, if you are using CUDA, FreeTensor and PyTorch should link CUDA
of <em>the same version</em>. PyTorch can be installed in any way you like, see <a href="https://pytorch.org/get-started/locally/">PyTorch's guide</a>.</p>
</div>
<h2 id="build">Build<a class="headerlink" href="#build" title="Permanent link">&para;</a></h2>
<p>First, clone this repo. Don't forget there are some submodules.</p>
<pre><code class="language-sh">git clone --recursive &lt;path-to-this-repo&gt;
</code></pre>
<p>Then, build.</p>
<pre><code class="language-sh">mkdir build
cd build
cmake ..
make -j  # Or use Ninja
</code></pre>
<p>There are some options to <code>cmake</code>:</p>
<ul>
<li><code>-DFT_WITH_CUDA=ON/OFF</code>: build with/without CUDA (defaults to <code>ON</code>).</li>
<li>
<p><code>-DFT_WITH_MKL=&lt;path/to/mkl/root&gt;</code>: build with MKL (path to MKL is required, defaults to building without it).</p>
<p>The path accepts by CMake should be a raw unescaped path; i.e. <code>-DFT_WITH_MKL="/some path"</code> is good since the quotes are resolved by the shell but <code>-DFT_WITH_MKL=\"/some\ path\"</code> is not.</p>
</li>
<li>
<p><code>-DFT_WITH_PYTORCH=ON/OFF</code>: build with/without copy-free interface from/to PyTorch, requring PyTorch installed on the system (defaults to <code>OFF</code>).</p>
</li>
<li><code>-DFT_DEBUG_LOG_NODE=ON</code> (for developers): enables tracing to tell by which pass a specific AST node is modified.</li>
<li><code>-DFT_DEBUG_PROFILE=ON</code> (for developers): profiles some heavy functions in the compiler.</li>
<li><code>-DFT_DEBUG_SANITIZE=sanitizer_name</code> (for developers): build with GCC sanitizer (set it to a sanitizer name to use, e.g. address).</li>
</ul>
<p>It will build a shared library with a name like <code>freetensor_ffi.cpython-37m-x86_64-linux-gnu.so</code>, which can be used in Python via <code>import freetensor</code>.</p>
<h2 id="run-a-program-with-freetensor">Run a Program with FreeTensor<a class="headerlink" href="#run-a-program-with-freetensor" title="Permanent link">&para;</a></h2>
<p>To run any program with FreeTensor, one should add the <code>python/</code> and <code>build/</code> directory to <code>PYTHONPATH</code> first.</p>
<p>E.g. to run a python program <code>a.py</code> with FreeTensor in the <code>build/</code> directory,</p>
<pre><code class="language-sh">PYTHONPATH=../python:../build:$PYTHONPATH python3 a.py
</code></pre>
<h2 id="global-configurations">Global Configurations<a class="headerlink" href="#global-configurations" title="Permanent link">&para;</a></h2>
<p>There are serveral global configurations can be set via environment variables:</p>
<ul>
<li><code>FT_PRETTY_PRINT=ON/OFF</code>. Enable/disable colored printing.</li>
<li><code>FT_PRINT_ALL_ID=ON/OFF</code>. Print (or not) IDs of all statements in an AST.</li>
<li><code>FT_WERROR=ON/OFF</code>. Treat warnings as errors (or not).</li>
<li><code>FT_BACKEND_COMPILER_CXX=path_to_compiler</code>. The C++ compiler used to compiler the optimized program. Default to the same compiler found when building FreeTensor itself.</li>
<li><code>FT_BACKEND_COMPILER_NVCC=path_to_compiler</code>. The CUDA compiler used to compiler the optimized program (if built with CUDA). Default to the same compiler found when building FreeTensor itself.</li>
</ul>
<p>This configurations can also set at runtime in <a href="../../api/#freetensor.core.config"><code>ft.config</code></a>.</p>
<h2 id="run-the-tests">Run the Tests<a class="headerlink" href="#run-the-tests" title="Permanent link">&para;</a></h2>
<p>To run the test, first change into the <code>test/</code> directory, then</p>
<pre><code class="language-sh">PYTHONPATH=../python:../build:$PYTHONPATH pytest
</code></pre>
<p>To run a single test case, specify the test case name, and optionally use <code>pytest -s</code> to display the standard output. E.g,</p>
<pre><code class="language-sh">PYTHONPATH=../python:../build:$PYTHONPATH pytest -s 00.hello_world/test_basic.py::test_hello_world
</code></pre>
<div class="admonition note">
<p class="admonition-title">Debugging (for developers)</p>
<p>If using GDB, one should invoke PyTest with <code>python3 -m</code>:</p>
<p><code>PYTHONPATH=../python:../build:$PYTHONPATH gdb --args python3 -m pytest</code></p>
<p>If using Valgrind, one should set Python to use the system malloc:</p>
<p><code>PYTHONPATH=../python:../build:$PYTHONPATH PYTHONMALLOC=malloc valgrind python3 -m pytest</code></p>
<p>Sometimes Valgrind is not enough to detect some errors. An alternative is to use the sanitizer from GCC. For example, if you are using the "address" sanitizer, first set <code>-DFT_DEBUG_SANITIZE=address</code> to <code>cmake</code>, and then:</p>
<p><code>PYTHONPATH=../python:../build:$PYTHONPATH LD_PRELOAD=`gcc -print-file-name=libasan.so` pytest -s</code></p>
<p>If you are using another sanitizer, change the string set to <code>FT_DEBUG_SANITIZE</code> and the library's name. For example, <code>-DFT_DEBUG_SANITIZE=undefined</code> and <code>libubsan.so</code>.</p>
</div>
<h2 id="build-this-document">Build this Document<a class="headerlink" href="#build-this-document" title="Permanent link">&para;</a></h2>
<p>First install some dependencies:</p>
<pre><code class="language-sh">pip3 install --user mkdocs mkdocstrings==0.18.1 &quot;pytkdocs[numpy-style]&quot;
</code></pre>
<p>From the root directory of FreeTensor, run a HTTP server to serve the document (recommended, but without document on C++ interface due to <a href="https://github.com/mkdocs/mkdocs/issues/1901">a limitation</a>):</p>
<pre><code class="language-sh">PYTHONPATH=./python:./build:$PYTHONPATH mkdocs serve
</code></pre>
<p>Or build and save the pages (with document on C++ interface, requiring Doxygen and Graphviz):</p>
<pre><code class="language-sh">doxygen Doxyfile &amp;&amp; PYTHONPATH=./python:./build:$PYTHONPATH mkdocs build
</code></pre>
<div class="admonition note">
<p class="admonition-title">Publish the documents to GitHub Pages (for developers)</p>
<p><code>doxygen Doxyfile &amp;&amp; PYTHONPATH=./python:./build:$PYTHONPATH mkdocs gh-deploy</code></p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../" class="btn btn-neutral float-left" title="Get Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../first-program/" class="btn btn-neutral float-right" title="Your First Program with FreeTenor">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../first-program/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
